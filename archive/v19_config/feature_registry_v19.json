{
  "_meta": {
    "version": "V19",
    "model_id": "ppo_usdcop_v19_aggressive",
    "created_at": "2025-12-26",
    "description": "Complete feature registry for V19 training - matches TradingEnvironmentV19",
    "author": "Claude Code",
    "source_files": {
      "environment": "notebooks/Entrneamiento PPOV1/src/environment_v19.py",
      "preprocessing": "notebooks/Entrneamiento PPOV1/src/preprocessing.py",
      "sample_data": "notebooks/Entrneamiento PPOV1/data_sample_100rows.csv",
      "production_config": "notebooks/Entrneamiento PPOV1/PRODUCTION_CONFIG.json"
    }
  },

  "observation_space": {
    "total_dimension": 30,
    "state_features_count": 12,
    "market_features_count": 18,
    "formula": "12 state features + 18 market features = 30 total"
  },

  "market_features": [
    {
      "name": "log_ret_5m",
      "observation_order": 0,
      "group": "returns",
      "source_column": "close",
      "transformation": "log_return",
      "lookback_bars": 1,
      "formula": "ln(close / close[-1])",
      "normalization": {
        "method": "z_score",
        "mean": 2.0e-06,
        "std": 0.001138,
        "clip": [-0.05, 0.05]
      },
      "description": "5-minute log return"
    },
    {
      "name": "log_ret_1h",
      "observation_order": 1,
      "group": "returns",
      "source_column": "close",
      "transformation": "log_return",
      "lookback_bars": 12,
      "formula": "ln(close / close[-12])",
      "normalization": {
        "method": "z_score",
        "mean": 2.3e-05,
        "std": 0.003776,
        "clip": [-0.05, 0.05]
      },
      "description": "1-hour log return (12 x 5-min bars)"
    },
    {
      "name": "log_ret_4h",
      "observation_order": 2,
      "group": "returns",
      "source_column": "close",
      "transformation": "log_return",
      "lookback_bars": 48,
      "formula": "ln(close / close[-48])",
      "normalization": {
        "method": "z_score",
        "mean": 5.2e-05,
        "std": 0.007768,
        "clip": [-0.05, 0.05]
      },
      "description": "4-hour log return (48 x 5-min bars)"
    },
    {
      "name": "rsi_9",
      "observation_order": 3,
      "group": "technical",
      "source_column": "close",
      "transformation": "rsi",
      "period": 9,
      "normalization": {
        "method": "z_score",
        "mean": 49.27,
        "std": 23.07,
        "clip": null
      },
      "range": [0, 100],
      "description": "Relative Strength Index 9-period"
    },
    {
      "name": "atr_pct",
      "observation_order": 4,
      "group": "technical",
      "source_columns": ["high", "low", "close"],
      "transformation": "atr_percent",
      "period": 10,
      "formula": "(ATR / close) * 100",
      "normalization": {
        "method": "z_score",
        "mean": 0.062,
        "std": 0.0446,
        "clip": null
      },
      "description": "Average True Range as percentage of close"
    },
    {
      "name": "adx_14",
      "observation_order": 5,
      "group": "technical",
      "source_columns": ["high", "low", "close"],
      "transformation": "adx",
      "period": 14,
      "normalization": {
        "method": "z_score",
        "mean": 32.01,
        "std": 16.36,
        "clip": null
      },
      "range": [0, 100],
      "description": "Average Directional Index 14-period"
    },
    {
      "name": "bb_position",
      "observation_order": 6,
      "group": "technical",
      "source_column": "close",
      "transformation": "bollinger_position",
      "period": 20,
      "std_dev": 2,
      "formula": "(close - bb_lower) / (bb_upper - bb_lower)",
      "normalization": {
        "method": "none",
        "clip": [0.0, 1.0]
      },
      "range": [0, 1],
      "description": "Position within Bollinger Bands (0=lower, 1=upper)"
    },
    {
      "name": "dxy_z",
      "observation_order": 7,
      "group": "macro_zscore",
      "source_column": "dxy",
      "transformation": "zscore_fixed",
      "normalization": {
        "method": "z_score",
        "mean": 100.21,
        "std": 5.60,
        "clip": [-4, 4]
      },
      "description": "Dollar Index (DXY) z-score normalized"
    },
    {
      "name": "dxy_change_1d",
      "observation_order": 8,
      "group": "macro_changes",
      "source_column": "dxy",
      "transformation": "pct_change",
      "periods": 1,
      "normalization": {
        "method": "clip_only",
        "clip": [-0.03, 0.03]
      },
      "description": "Daily DXY percent change"
    },
    {
      "name": "dxy_mom_5d",
      "observation_order": 9,
      "group": "macro_momentum",
      "source_column": "dxy",
      "transformation": "pct_change",
      "periods": 5,
      "normalization": {
        "method": "clip_only",
        "clip": [-0.05, 0.05]
      },
      "description": "5-day DXY momentum"
    },
    {
      "name": "vix_z",
      "observation_order": 10,
      "group": "macro_zscore",
      "source_column": "vix",
      "transformation": "zscore_fixed",
      "normalization": {
        "method": "z_score",
        "mean": 21.16,
        "std": 7.89,
        "clip": [-4, 4]
      },
      "description": "VIX z-score normalized"
    },
    {
      "name": "embi_z",
      "observation_order": 11,
      "group": "macro_zscore",
      "source_column": "embi",
      "transformation": "zscore_fixed",
      "normalization": {
        "method": "z_score",
        "mean": 322.01,
        "std": 62.68,
        "clip": [-4, 4]
      },
      "description": "EMBI spread z-score normalized"
    },
    {
      "name": "brent_change_1d",
      "observation_order": 12,
      "group": "macro_changes",
      "source_column": "brent",
      "transformation": "pct_change",
      "periods": 1,
      "normalization": {
        "method": "clip_only",
        "clip": [-0.10, 0.10]
      },
      "description": "Daily Brent crude oil percent change"
    },
    {
      "name": "brent_vol_5d",
      "observation_order": 13,
      "group": "macro_volatility",
      "source_column": "brent",
      "transformation": "rolling_std",
      "period": 5,
      "normalization": {
        "method": "clip_only",
        "clip": [0.0, 0.05]
      },
      "description": "5-day Brent volatility"
    },
    {
      "name": "rate_spread",
      "observation_order": 14,
      "group": "macro_derived",
      "source_columns": ["treasury_10y"],
      "transformation": "derived",
      "formula": "10.0 - treasury_10y",
      "normalization": {
        "method": "z_score",
        "mean": 7.03,
        "std": 1.41,
        "clip": null
      },
      "description": "Sovereign spread: Colombia 10Y (10%) - USA 10Y"
    },
    {
      "name": "usdmxn_change_1d",
      "observation_order": 15,
      "group": "macro_changes",
      "source_column": "usdmxn",
      "transformation": "pct_change",
      "periods": 1,
      "normalization": {
        "method": "clip_only",
        "clip": [-0.10, 0.10]
      },
      "description": "Daily USD/MXN percent change (peso proxy)"
    },
    {
      "name": "hour_sin",
      "observation_order": 16,
      "group": "temporal",
      "source_column": "timestamp",
      "transformation": "cyclical_hour_sin",
      "formula": "sin(2 * pi * hour / 24)",
      "normalization": {
        "method": "none",
        "clip": null
      },
      "range": [-1, 1],
      "description": "Hour of day (sine encoding)"
    },
    {
      "name": "hour_cos",
      "observation_order": 17,
      "group": "temporal",
      "source_column": "timestamp",
      "transformation": "cyclical_hour_cos",
      "formula": "cos(2 * pi * hour / 24)",
      "normalization": {
        "method": "none",
        "clip": null
      },
      "range": [-1, 1],
      "description": "Hour of day (cosine encoding)"
    }
  ],

  "state_features": [
    {
      "name": "position",
      "observation_order": 0,
      "group": "portfolio_state",
      "source": "environment",
      "normalization": {
        "method": "none",
        "range": [-1.0, 1.0]
      },
      "description": "Current position normalized [-1 short, 0 flat, 1 long]"
    },
    {
      "name": "unrealized_pnl",
      "observation_order": 1,
      "group": "portfolio_state",
      "source": "environment",
      "normalization": {
        "method": "clip_normalize",
        "divisor": 0.05,
        "clip": [-1, 1]
      },
      "formula": "clip(unrealized_pnl / 0.05, -1, 1)",
      "description": "Unrealized PnL normalized by 5% threshold"
    },
    {
      "name": "cumulative_return",
      "observation_order": 2,
      "group": "portfolio_state",
      "source": "environment",
      "normalization": {
        "method": "clip_normalize",
        "divisor": 0.10,
        "clip": [-1, 1]
      },
      "formula": "clip(cumulative_return / 0.10, -1, 1)",
      "description": "Episode cumulative return normalized by 10%"
    },
    {
      "name": "current_drawdown",
      "observation_order": 3,
      "group": "risk_state",
      "source": "environment",
      "normalization": {
        "method": "scale_negative",
        "divisor": "max_drawdown_pct"
      },
      "formula": "-current_drawdown / max_drawdown_pct",
      "description": "Current drawdown as fraction of max allowed (negative)"
    },
    {
      "name": "max_drawdown_episode",
      "observation_order": 4,
      "group": "risk_state",
      "source": "environment",
      "normalization": {
        "method": "scale_negative",
        "divisor": "max_drawdown_pct"
      },
      "formula": "-max_drawdown_episode / max_drawdown_pct",
      "description": "Max drawdown this episode (negative)"
    },
    {
      "name": "regime_encoded",
      "observation_order": 5,
      "group": "market_regime",
      "source": "environment",
      "normalization": {
        "method": "none",
        "range": [-0.5, 1.0]
      },
      "encoding": {
        "crisis": 1.0,
        "high_volatility": 0.5,
        "normal": 0.0,
        "low_volatility": -0.5
      },
      "description": "Market regime encoded based on volatility percentile"
    },
    {
      "name": "session_phase",
      "observation_order": 6,
      "group": "temporal_state",
      "source": "environment",
      "normalization": {
        "method": "none",
        "range": [0.1, 0.8]
      },
      "encoding": {
        "ny_am": 0.8,
        "ny_pm": 0.6,
        "asia_early": 0.3,
        "london": 0.2,
        "closed": 0.1
      },
      "description": "Trading session phase (liquidity proxy)"
    },
    {
      "name": "volatility_regime",
      "observation_order": 7,
      "group": "risk_state",
      "source": "environment",
      "normalization": {
        "method": "percentile",
        "range": [0.0, 1.0]
      },
      "description": "Volatility percentile [0=low, 1=high]"
    },
    {
      "name": "cost_regime",
      "observation_order": 8,
      "group": "cost_state",
      "source": "environment",
      "normalization": {
        "method": "none",
        "range": [0.0, 1.0]
      },
      "description": "Curriculum cost multiplier (0=free, 1=full costs)"
    },
    {
      "name": "position_duration",
      "observation_order": 9,
      "group": "portfolio_state",
      "source": "environment",
      "normalization": {
        "method": "min_scale",
        "divisor": 100,
        "clip": [0, 1]
      },
      "formula": "min(position_duration / 100, 1.0)",
      "description": "Bars holding current position (normalized)"
    },
    {
      "name": "trade_count_normalized",
      "observation_order": 10,
      "group": "portfolio_state",
      "source": "environment",
      "normalization": {
        "method": "min_scale",
        "divisor": 50,
        "clip": [0, 1]
      },
      "formula": "min(trade_count / 50, 1.0)",
      "description": "Trades executed this episode (normalized)"
    },
    {
      "name": "time_remaining",
      "observation_order": 11,
      "group": "temporal_state",
      "source": "environment",
      "normalization": {
        "method": "none",
        "range": [0.0, 1.0]
      },
      "formula": "1.0 - (current_step / episode_length)",
      "description": "Fraction of episode remaining"
    }
  ],

  "feature_groups": {
    "returns": {
      "features": ["log_ret_5m", "log_ret_1h", "log_ret_4h"],
      "count": 3,
      "description": "Multi-timeframe log returns"
    },
    "technical": {
      "features": ["rsi_9", "atr_pct", "adx_14", "bb_position"],
      "count": 4,
      "description": "Technical indicators from OHLCV"
    },
    "macro_zscore": {
      "features": ["dxy_z", "vix_z", "embi_z"],
      "count": 3,
      "description": "Macro variables with fixed z-score normalization"
    },
    "macro_changes": {
      "features": ["dxy_change_1d", "brent_change_1d", "usdmxn_change_1d"],
      "count": 3,
      "description": "Daily percent changes (clip only, no z-score)"
    },
    "macro_momentum": {
      "features": ["dxy_mom_5d"],
      "count": 1,
      "description": "Multi-day momentum indicators"
    },
    "macro_volatility": {
      "features": ["brent_vol_5d"],
      "count": 1,
      "description": "Rolling volatility of macro variables"
    },
    "macro_derived": {
      "features": ["rate_spread"],
      "count": 1,
      "description": "Derived features from multiple macro columns"
    },
    "temporal": {
      "features": ["hour_sin", "hour_cos"],
      "count": 2,
      "description": "Cyclical time encoding"
    },
    "portfolio_state": {
      "features": ["position", "unrealized_pnl", "cumulative_return", "position_duration", "trade_count_normalized"],
      "count": 5,
      "description": "Portfolio and trading state"
    },
    "risk_state": {
      "features": ["current_drawdown", "max_drawdown_episode", "volatility_regime"],
      "count": 3,
      "description": "Risk metrics"
    },
    "market_regime": {
      "features": ["regime_encoded"],
      "count": 1,
      "description": "Market regime classification"
    },
    "temporal_state": {
      "features": ["session_phase", "time_remaining"],
      "count": 2,
      "description": "Time-based state features"
    },
    "cost_state": {
      "features": ["cost_regime"],
      "count": 1,
      "description": "Transaction cost state"
    }
  },

  "environment_config": {
    "class": "TradingEnvironmentV19",
    "initial_balance": 10000,
    "max_position": 1.0,
    "episode_length": 400,
    "max_drawdown_pct": 15.0,
    "bars_per_day": 56,
    "use_vol_scaling": true,
    "use_regime_detection": true,
    "volatility_column": "atr_pct",
    "return_column": "log_ret_5m"
  },

  "cost_model": {
    "class": "SETFXCostModel",
    "base_spread_bps": 14.0,
    "high_vol_spread_bps": 28.0,
    "crisis_spread_bps": 45.0,
    "slippage_bps": 3.0,
    "volatility_threshold_high": 0.7,
    "volatility_threshold_crisis": 0.9
  },

  "volatility_scaler": {
    "lookback_window": 60,
    "quantiles": [0.5, 0.75, 0.9],
    "scale_factors": [1.0, 0.75, 0.5, 0.25],
    "description": "Position sizing: crisis(p90+)=25%, high(p75+)=50%, med(p50+)=75%, normal=100%"
  },

  "data_sources": {
    "ohlcv": {
      "table": "usdcop_m5_ohlcv",
      "columns": ["timestamp", "open", "high", "low", "close"],
      "granularity": "5min"
    },
    "macro": {
      "table": "macro_indicators_daily",
      "columns": ["date", "dxy", "vix", "embi", "brent", "treasury_10y", "usdmxn"],
      "granularity": "daily",
      "resample": "ffill"
    }
  },

  "validation": {
    "expected_market_features": 18,
    "expected_state_features": 12,
    "expected_total_dimension": 30,
    "feature_order": [
      "position", "unrealized_pnl", "cumulative_return", "current_drawdown",
      "max_drawdown_episode", "regime_encoded", "session_phase", "volatility_regime",
      "cost_regime", "position_duration", "trade_count_normalized", "time_remaining",
      "log_ret_5m", "log_ret_1h", "log_ret_4h", "rsi_9", "atr_pct", "adx_14",
      "bb_position", "dxy_z", "dxy_change_1d", "dxy_mom_5d", "vix_z", "embi_z",
      "brent_change_1d", "brent_vol_5d", "rate_spread", "usdmxn_change_1d",
      "hour_sin", "hour_cos"
    ]
  }
}
