# Flujo de ProducciÃ³n Completo: Datos â†’ API â†’ Inferencia

## Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FLUJO DE PRODUCCIÃ“N USD/COP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚    L0    â”‚â”€â”€â”€â–ºâ”‚    L1    â”‚â”€â”€â”€â–ºâ”‚    L5    â”‚â”€â”€â”€â–ºâ”‚  MLOps   â”‚â”€â”€â”€â–ºâ”‚   API    â”‚       â”‚
â”‚  â”‚ Raw Data â”‚    â”‚ Features â”‚    â”‚Inference â”‚    â”‚  Engine  â”‚    â”‚Dashboard â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚              â”‚               â”‚               â”‚               â”‚              â”‚
â”‚       â–¼              â–¼               â–¼               â–¼               â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                        PostgreSQL + Redis                                 â”‚       â”‚
â”‚  â”‚  usdcop_m5_ohlcv â”‚ inference_features_5m â”‚ model_inferences â”‚ signals    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Horario de OperaciÃ³n

| Hora COT | Hora UTC | Actividad |
|----------|----------|-----------|
| 8:00 AM | 13:00 | Apertura mercado - L0/L1/L5 inician |
| 8:05 - 12:50 | 13:05 - 17:50 | Ciclos cada 5 minutos |
| 12:55 PM | 17:55 | Ãšltima barra del dÃ­a |
| 12:55 - 8:00 | 17:55 - 13:00 | Off-hours (backups, retraining) |

**Cron Schedule:** `*/5 13-17 * * 1-5` (Lun-Vie, cada 5 min)

---

## Fase 1: AdquisiciÃ³n de Datos (L0)

### DAGs Involucrados
- `v3.l0_ohlcv_realtime` - Datos OHLCV en tiempo real
- `v3.l0_macro_unified` - Indicadores macro diarios

### Flujo L0

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     L0: RAW DATA ACQUISITION                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  TwelveData API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  (USD/COP 5min)           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚  ValidaciÃ³n â”‚                              â”‚
â”‚                    â”‚  - DÃ­a hÃ¡bilâ”‚                              â”‚
â”‚                    â”‚  - Hora OK  â”‚                              â”‚
â”‚                    â”‚  - No gaps  â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚           usdcop_m5_ohlcv                    â”‚               â”‚
â”‚  â”‚  time | open | high | low | close | volume  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  FRED, BanRep, Investing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  (DXY, VIX, EMBI, Brent, etc)     â”‚ (Diario)                   â”‚
â”‚                                    â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚           macro_indicators_daily             â”‚               â”‚
â”‚  â”‚  fecha | dxy | vix | embi | brent | ...     â”‚               â”‚
â”‚  â”‚         (37 indicadores macro)              â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Datos Capturados

**OHLCV (cada 5 minutos):**
```sql
-- Tabla: usdcop_m5_ohlcv
time                    | symbol   | open     | high     | low      | close    | volume
2025-01-08 13:30:00+00 | USD/COP  | 4385.50  | 4386.20  | 4384.80  | 4385.90  | 1250
```

**Macro (diario, 37 variables):**
- DXY (Dollar Index)
- VIX (Volatilidad)
- EMBI Colombia (Riesgo paÃ­s)
- Brent (PetrÃ³leo)
- Tasas USA (10Y, 2Y)
- USD/MXN (correlaciÃ³n regional)

---

## Fase 2: Feature Engineering (L1)

### DAG Involucrado
- `v3.l1_feature_refresh`

### Flujo L1

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     L1: FEATURE ENGINEERING                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  usdcop_m5_ohlcv â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  (Ãºltimas 100 barras)     â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  CÃ¡lculo Python â”‚                          â”‚
â”‚                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                          â”‚
â”‚                    â”‚  â€¢ log_ret_5m   â”‚  ln(close/close[-1])     â”‚
â”‚                    â”‚  â€¢ log_ret_1h   â”‚  ln(close/close[-12])    â”‚
â”‚                    â”‚  â€¢ log_ret_4h   â”‚  ln(close/close[-48])    â”‚
â”‚                    â”‚  â€¢ rsi_9        â”‚  RSI(9 perÃ­odos)         â”‚
â”‚                    â”‚  â€¢ atr_pct      â”‚  ATR/close               â”‚
â”‚                    â”‚  â€¢ adx_14       â”‚  ADX(14 perÃ­odos)        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚                                    â”‚
â”‚  macro_indicators_daily â”€â”€â”€â”€â”¤                                    â”‚
â”‚  (Ãºltimos 30 dÃ­as)          â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  FFILL + Z-scoreâ”‚                          â”‚
â”‚                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                          â”‚
â”‚                    â”‚  â€¢ dxy_z        â”‚  Z-score normalizado     â”‚
â”‚                    â”‚  â€¢ dxy_change_1dâ”‚  % cambio diario         â”‚
â”‚                    â”‚  â€¢ vix_z        â”‚  Z-score normalizado     â”‚
â”‚                    â”‚  â€¢ embi_z       â”‚  Z-score normalizado     â”‚
â”‚                    â”‚  â€¢ brent_chg_1d â”‚  % cambio diario         â”‚
â”‚                    â”‚  â€¢ rate_spread  â”‚  10Y - 2Y yield          â”‚
â”‚                    â”‚  â€¢ usdmxn_chg_1dâ”‚  % cambio diario         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              inference_features_5m                       â”‚    â”‚
â”‚  â”‚  time | log_ret_5m | rsi_9 | dxy_z | vix_z | ...        â”‚    â”‚
â”‚  â”‚           (13 features por barra de 5 min)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Las 13 Features de Mercado

| # | Feature | Tipo | Fuente | DescripciÃ³n |
|---|---------|------|--------|-------------|
| 1 | `log_ret_5m` | Retorno | OHLCV | Log-return 5 minutos |
| 2 | `log_ret_1h` | Retorno | OHLCV | Log-return 1 hora |
| 3 | `log_ret_4h` | Retorno | OHLCV | Log-return 4 horas |
| 4 | `rsi_9` | TÃ©cnico | OHLCV | RSI 9 perÃ­odos |
| 5 | `atr_pct` | Volatilidad | OHLCV | ATR como % del precio |
| 6 | `adx_14` | Tendencia | OHLCV | ADX 14 perÃ­odos |
| 7 | `dxy_z` | Macro | FRED | Z-score DXY |
| 8 | `dxy_change_1d` | Macro | FRED | Cambio % DXY |
| 9 | `vix_z` | Macro | FRED | Z-score VIX |
| 10 | `embi_z` | Macro | BanRep | Z-score EMBI Colombia |
| 11 | `brent_change_1d` | Macro | Investing | Cambio % Brent |
| 12 | `rate_spread` | Macro | FRED | Spread 10Y-2Y USA |
| 13 | `usdmxn_change_1d` | Macro | TwelveData | Cambio % USD/MXN |

---

## Fase 3: Inferencia con Modelo PPO (L5)

### DAG Involucrado
- `v3.l5_multi_model_inference`

### Flujo L5 Actual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     L5: MODEL INFERENCE (Actual)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  inference_features_5m â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  (Ãºltima barra)                â”‚                                â”‚
â”‚                                â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚   Build Observation    â”‚                    â”‚
â”‚                    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                    â”‚
â”‚                    â”‚   13 market features   â”‚                    â”‚
â”‚                    â”‚   + 2 state features:  â”‚                    â”‚
â”‚                    â”‚     â€¢ position [-1,1]  â”‚                    â”‚
â”‚                    â”‚     â€¢ time_norm [0,1]  â”‚                    â”‚
â”‚                    â”‚   = 15 dimensions      â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚   PPO Model (.zip)     â”‚                    â”‚
â”‚                    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                    â”‚
â”‚                    â”‚   Stable-Baselines3   â”‚                    â”‚
â”‚                    â”‚   Latency: ~50-100ms  â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚   Action Probabilities â”‚                    â”‚
â”‚                    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                    â”‚
â”‚                    â”‚   [SELL, HOLD, BUY]   â”‚                    â”‚
â”‚                    â”‚   [0.15, 0.25, 0.60]  â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           trading.model_inferences                       â”‚    â”‚
â”‚  â”‚  timestamp | signal | confidence | latency_ms | ...     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Fase 4: MLOps Production Inference (NUEVO)

### IntegraciÃ³n con Sistema MLOps

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MLOPS INFERENCE ENGINE (Nuevo)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  inference_features_5m â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  (PostgreSQL)                  â”‚                                â”‚
â”‚                                â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚     Feature Cache      â”‚                    â”‚
â”‚                    â”‚     (Redis)            â”‚                    â”‚
â”‚                    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                    â”‚
â”‚                    â”‚   TTL: 5 minutos      â”‚                    â”‚
â”‚                    â”‚   Feature ordering    â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               ONNX RUNTIME INFERENCE                     â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚    â”‚
â”‚  â”‚    â”‚   PPO   â”‚   â”‚   SAC   â”‚   â”‚   A2C   â”‚              â”‚    â”‚
â”‚  â”‚    â”‚  v3.onnxâ”‚   â”‚ v2.onnx â”‚   â”‚ v1.onnx â”‚              â”‚    â”‚
â”‚  â”‚    â”‚ w: 1.0  â”‚   â”‚ w: 0.8  â”‚   â”‚ w: 0.6  â”‚              â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â”‚         â”‚             â”‚             â”‚                    â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚    â”‚
â”‚  â”‚                       â”‚                                  â”‚    â”‚
â”‚  â”‚                       â–¼                                  â”‚    â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚    â”‚
â”‚  â”‚              â”‚    ENSEMBLE     â”‚                         â”‚    â”‚
â”‚  â”‚              â”‚ Weighted Averageâ”‚                         â”‚    â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚    â”‚
â”‚  â”‚                       â”‚                                  â”‚    â”‚
â”‚  â”‚              Latency: < 5ms                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   RISK MANAGER                           â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 1: Confidence â‰¥ 60%                       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 2: Trading hours (8AM-12:55PM COT)        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 3: Circuit breaker not active             â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 4: Daily loss < -2%                       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 5: Drawdown < -5%                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 6: Consecutive losses < 5                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  CHECK 7: Trades today < 50                      â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Result: APPROVED / REJECTED / HOLD                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    API RESPONSE                          â”‚    â”‚
â”‚  â”‚  {                                                       â”‚    â”‚
â”‚  â”‚    "signal": "BUY",                                     â”‚    â”‚
â”‚  â”‚    "confidence": 0.78,                                  â”‚    â”‚
â”‚  â”‚    "approved": true,                                    â”‚    â”‚
â”‚  â”‚    "risk_status": "APPROVED",                           â”‚    â”‚
â”‚  â”‚    "latency_ms": 4.2,                                   â”‚    â”‚
â”‚  â”‚    "position_recommendation": {                         â”‚    â”‚
â”‚  â”‚      "position_size_percent": 0.08,                     â”‚    â”‚
â”‚  â”‚      "risk_level": "medium"                             â”‚    â”‚
â”‚  â”‚    }                                                    â”‚    â”‚
â”‚  â”‚  }                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo Completo: Minuto a Minuto

### Ejemplo: 8:05 AM COT (Primera barra del dÃ­a)

```
TIEMPO        COMPONENTE              ACCIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

08:00:00      Trading Calendar        âœ“ DÃ­a hÃ¡bil confirmado

08:05:00      L0 DAG                  Trigger automÃ¡tico
08:05:02      TwelveData API          GET /time_series?symbol=USD/COP
08:05:03      L0 Validation           âœ“ Datos vÃ¡lidos
08:05:04      PostgreSQL              INSERT INTO usdcop_m5_ohlcv

08:05:05      L1 DAG                  Trigger (sensor detecta nueva barra)
08:05:06      Feature Calc            Cargar Ãºltimas 100 barras OHLCV
08:05:07      Feature Calc            Calcular: log_ret, rsi, atr, adx
08:05:08      Macro FFILL             Cargar macro diario â†’ FFILL a 5min
08:05:09      PostgreSQL              INSERT INTO inference_features_5m

08:05:10      L5 DAG                  Trigger (sensor detecta features)
08:05:11      StateTracker            position=0, time_norm=0.017
08:05:12      Observation             Build 15-dim vector
08:05:13      PPO Model               model.predict(observation)
08:05:15      Result                  action=BUY, confidence=0.72
08:05:16      PostgreSQL              INSERT INTO model_inferences
08:05:17      Redis                   XADD signals:ppo_v1:stream

â”€â”€â”€ ALTERNATIVA CON MLOPS (MÃ¡s rÃ¡pido) â”€â”€â”€

08:05:10      MLOps API               POST /v1/inference
08:05:10      Feature Cache           GET from Redis (hit) or DB (miss)
08:05:11      ONNX Runtime            Inference PPO+SAC+A2C ensemble
08:05:11      Risk Manager            Check all 7 risk conditions
08:05:12      Response                {signal: BUY, approved: true}

              Total latency: ~2-5ms vs ~50-100ms (SB3)
```

---

## ComparaciÃ³n: L5 Actual vs MLOps Engine

| Aspecto | L5 Actual (SB3) | MLOps Engine (ONNX) |
|---------|-----------------|---------------------|
| **Latencia** | 50-100ms | 2-5ms |
| **Formato modelo** | .zip (PyTorch) | .onnx |
| **Ensemble** | No | SÃ­ (weighted) |
| **Risk Management** | BÃ¡sico | Completo (circuit breaker) |
| **Feature Cache** | No | Redis con TTL |
| **Drift Detection** | No | Evidently AI |
| **API** | Interno | REST endpoints |
| **Position Sizing** | Manual | AutomÃ¡tico |

---

## IntegraciÃ³n Recomendada

### OpciÃ³n 1: MLOps como Reemplazo de L5

```python
# En l5_multi_model_inference.py, reemplazar:
# model = PPO.load(model_path)
# action, _ = model.predict(observation)

# Por:
import requests

response = requests.post(
    "http://mlops-inference-api:8090/v1/inference",
    json={
        "observation": observation.tolist(),
        "use_ensemble": True,
        "enforce_risk_checks": True
    }
)
result = response.json()
signal = result["signal"]
confidence = result["confidence"]
approved = result["approved"]
```

### OpciÃ³n 2: MLOps como Servicio Paralelo

```
L5 DAG (SB3)         MLOps API (ONNX)
     â”‚                     â”‚
     â–¼                     â–¼
model_inferences    mlops_inferences
     â”‚                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        ComparaciÃ³n A/B
        (Shadow Mode)
```

### OpciÃ³n 3: MigraciÃ³n Gradual

1. **Fase 1**: Exportar modelo PPO a ONNX
2. **Fase 2**: Correr MLOps en shadow mode (no ejecuta trades)
3. **Fase 3**: Validar que ONNX produce mismos resultados que SB3
4. **Fase 4**: Switchear a MLOps como primario
5. **Fase 5**: Deprecar L5 DAG

---

## Exportar Modelo PPO a ONNX

```bash
# Tu modelo actual
MODEL_PATH="models/ppo_v1_20251226_054154.zip"

# Exportar a ONNX
python scripts/mlops/export_model_onnx.py \
    --model-path $MODEL_PATH \
    --output-path models/onnx/ppo_usdcop_v3.onnx \
    --algorithm PPO \
    --observation-dim 15 \
    --verify

# Verificar
python -c "
import onnxruntime as ort
import numpy as np

sess = ort.InferenceSession('models/onnx/ppo_usdcop_v3.onnx')
obs = np.random.randn(1, 15).astype(np.float32)
result = sess.run(None, {'obs': obs})
print(f'Output shape: {result[0].shape}')
print(f'Action probs: {result[0]}')
"
```

---

## Monitoreo de Drift

### DAG: `mlops_drift_monitor`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DRIFT MONITORING FLOW                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Schedule: 0 9-12 * * 1-5 (Hourly during trading)               â”‚
â”‚                                                                  â”‚
â”‚  1. Load Reference Data                                          â”‚
â”‚     â””â”€â–º inference_features_5m (Ãºltimos 30 dÃ­as)                 â”‚
â”‚                                                                  â”‚
â”‚  2. Load Current Data                                            â”‚
â”‚     â””â”€â–º inference_features_5m (Ãºltima hora)                     â”‚
â”‚                                                                  â”‚
â”‚  3. Calculate Drift                                              â”‚
â”‚     â””â”€â–º KS-test por cada feature                                â”‚
â”‚     â””â”€â–º drift_share = features_drifted / total_features         â”‚
â”‚                                                                  â”‚
â”‚  4. Store Results                                                â”‚
â”‚     â””â”€â–º Redis: drift:latest, drift:log                          â”‚
â”‚                                                                  â”‚
â”‚  5. Alert if drift_share > 15%                                   â”‚
â”‚     â””â”€â–º Redis: drift:alert (TTL 1 hora)                         â”‚
â”‚     â””â”€â–º Log: ğŸš¨ DATA DRIFT ALERT                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tablas de Base de Datos

### Flujo de Datos por Tabla

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE TABLES FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  L0 â”€â”€â–º usdcop_m5_ohlcv            (OHLCV cada 5 min)                    â”‚
â”‚         macro_indicators_daily      (Macro diario)                        â”‚
â”‚                                                                           â”‚
â”‚  L1 â”€â”€â–º inference_features_5m       (13 features cada 5 min)             â”‚
â”‚                                                                           â”‚
â”‚  L5 â”€â”€â–º trading.model_inferences    (Inferencias del modelo)             â”‚
â”‚         dw.fact_strategy_signals    (SeÃ±ales para dashboard)             â”‚
â”‚                                                                           â”‚
â”‚  MLOps â–º Redis: features:*          (Feature cache)                       â”‚
â”‚          Redis: risk:*              (Risk state)                          â”‚
â”‚          Redis: drift:*             (Drift reports)                       â”‚
â”‚          Redis: signals:*:stream    (Real-time signals)                   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Endpoints de API

### Trading API (puerto 8000)
```
GET  /api/signals/latest          â†’ Ãšltima seÃ±al
GET  /api/signals/history         â†’ Historial de seÃ±ales
GET  /api/market/realtime         â†’ Precio actual
GET  /api/health                  â†’ Health check
```

### MLOps Inference API (puerto 8090)
```
POST /v1/inference                â†’ Inferencia con risk checks
POST /v1/inference/batch          â†’ Batch inference
GET  /v1/risk/summary             â†’ Estado de riesgo
POST /v1/risk/trade-result        â†’ Actualizar resultado trade
GET  /v1/metrics                  â†’ MÃ©tricas del servicio
GET  /v1/models                   â†’ Modelos cargados
GET  /health                      â†’ Health check
```

### Dashboard (puerto 5000)
```
/                                 â†’ Landing page
/trading                          â†’ Terminal de trading
/dashboard                        â†’ Dashboard ejecutivo
/api/trading/signals/multi-strategy â†’ SeÃ±ales multi-modelo
```

---

## Resumen del Flujo

```
                              FLUJO COMPLETO DE PRODUCCIÃ“N
                              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                                  â”‚
     â”‚   TwelveData â”€â”€â–º L0 DAG â”€â”€â–º usdcop_m5_ohlcv                     â”‚
     â”‚   FRED, etc  â”€â”€â–º         â”€â”€â–º macro_indicators_daily             â”‚
     â”‚                                     â”‚                            â”‚
     â”‚                                     â–¼                            â”‚
     â”‚                              L1 DAG                              â”‚
     â”‚                     (Feature Engineering)                        â”‚
     â”‚                                     â”‚                            â”‚
     â”‚                                     â–¼                            â”‚
     â”‚                        inference_features_5m                     â”‚
     â”‚                          (13 features/bar)                       â”‚
     â”‚                                     â”‚                            â”‚
     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚              â”‚                      â”‚                      â”‚     â”‚
     â”‚              â–¼                      â–¼                      â–¼     â”‚
     â”‚         L5 DAG              MLOps API               Dashboard    â”‚
     â”‚        (SB3 PPO)           (ONNX PPO)              (Next.js)    â”‚
     â”‚              â”‚                      â”‚                      â”‚     â”‚
     â”‚              â”‚                      â”‚                      â”‚     â”‚
     â”‚              â–¼                      â–¼                      â”‚     â”‚
     â”‚      model_inferences        Risk Manager                 â”‚     â”‚
     â”‚              â”‚                      â”‚                      â”‚     â”‚
     â”‚              â”‚                      â–¼                      â”‚     â”‚
     â”‚              â”‚              Approved Signal                â”‚     â”‚
     â”‚              â”‚                      â”‚                      â”‚     â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                                     â”‚                            â”‚
     â”‚                                     â–¼                            â”‚
     â”‚                           Trading Decision                       â”‚
     â”‚                         LONG / SHORT / HOLD                      â”‚
     â”‚                                                                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## PrÃ³ximos Pasos

1. **Exportar PPO actual a ONNX**
   ```bash
   python scripts/mlops/export_model_onnx.py \
       --model-path models/ppo_v1_20251226_054154.zip \
       --output-path models/onnx/ppo_usdcop_v3.onnx \
       --algorithm PPO --observation-dim 15
   ```

2. **Iniciar servicio MLOps**
   ```bash
   docker-compose up -d mlops-inference-api
   ```

3. **Verificar integraciÃ³n**
   ```bash
   curl http://localhost:8090/health
   pytest tests/integration/test_mlops_integration.py -v
   ```

4. **Configurar dashboard para consumir MLOps API**
   - Actualizar `NEXT_PUBLIC_MLOPS_API_URL=http://localhost:8090`
   - Modificar hooks de trading para usar nuevo endpoint
